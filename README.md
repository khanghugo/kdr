# kdr - Khang's Demo Renderer

Currently work in progress, check back later

## Progresses - Subjected to changes and addition but not subtraction.

- Renderer
  - BSP
    - [X] Face
    - [X] Texture
    - [X] Lightmap
    - [X] Weird math lightmap in the case of older compiled HL maps. FIXED
    - [ ] Light styles (unplanned)
    - Transparency
      - [X] Alpha test ("rendermode" = 4)
      - [X] Beter alpha test
      - "rendermode"
        - [X] general entity brush transparency
        - [ ] very correct transparency for according rendermode, aka everything else beside 4 or 0
      - [X] "renderamt"
    - [X] Named entities. Some entities aren't properly displaced
    - [X] Samey shader as the game
    - [X] ~~"rendermode"~~ (duplicated)
    - [ ] Water and futurely moving sprites
  - MDL
    - [X] Face
    - [X] Texture
    - [X] Model view projection
    - Bone based vertex transformation
      - [X] just simple stuffs
      - [ ] less simple stuffs like correctly load all of the transformation. At the moment, it seems like RLE decoding is very incorrectly implemented. The result is that the rotation is not that all correct. But for simple models like flags in chk_kobayashi, this seems to work just fine. More complicated models like chick.mdl in cs_italy doesn't seem to work well. 
    - [ ] Can load any model
    - [X] Shading
  - [X] Skybox
  - [ ] SPRites
  - Texture Filtering
    - [X] Linear. Comes with the graphic API. Looks bad.
    - [ ] Bilinear. Heh?
    - [X] Nearest neighbor with AA. Looks pretty good.
    - [X] Fast cubic.
    - [ ] Hotswap between texture filtering. This needs some egui integration, soon
  - Optimization
    - [X] Lightmap atlas
    - [X] Batch rendering based on texture
    - [X] Array of texture
    - Transparency sorting. Order independent transparency. Need to get WBOIT at the very least.
      - [X] Implemented WBOIT
    - [ ] Visibility. At the moment it renders everything. Or does it? It does render everything when there is some PVS tricks map like kz_hb_hopez or arte_drift.
    - [X] Mipmapping
    - [X] Z Pre Pass to eliminate overdraw for complicated maps like surf_cyberwave
  - [X] "FBO" rendering. There is a render surface and a swapchain surface.
  - Post Processing (for fun)
    - [X] Bloom
    - [ ] HDR
    - [X] ~~Anisotropic~~ Kuwahara Filtering
    - [X] Some random other shader effects just to prove that it is easy to add.
    - [ ] Posterize 
  - [ ] MSAA. Doesn't seem like a lot of work but not the priority.
- Navigation
  - [X] Noclip movement
  - [X] Pitch and Yaw
  - [ ] GoldSrc movement (unplanned)
  - [X] Mouse view. Similar to bspguy
- Demo Player
  - [X] Demo. Easy to do because this is the same code I have in other two projects
  - [ ] Viewmodel. That needs good MDL rendering first
  - [X] Ghost. Same thing. Very easy to implement
  - [X] Demo player UI. This needs to be compatible in both native and web. egui is the best bet. This needs some refactor to separate the "app" logic so that it is platform agnostic.
- Demo Renderer
  - [X] Framebuffer
  - [ ] Remux
  - [ ] Gstream or ffmpeg built-in. Gstream if everything contained but ffmpeg external binary seems nicer to work with.
- [X] BSP viewer. It is implicitly one.
- [ ] Demo checker. Seems like a cool addition. If I add the normal UI on top, should be easy to have demo checker UI similar to demo.unique-kz.net. That UI should be for scrubbing through the demo?
- Integration
  - Native
    - [X] Vulkan. This is the definitive backend
    - [X] OpenGL. This is the backup backend to test with WebGL2. So far, all of the weird kinks are ironed out
    - Config files. Somehow have a config files so that resource provider is correct. Like how bspguy does
      - [X] API server config
      - [X] Native kdr config
      - [ ] Web kdr config
  - Web
    - [X] WebGL2. Clear color is different than native OpenGL for some reasons.
    - [X] Minimal web example. This uses simple HTML script block. Basically no javascript or node project to help people bootstrap this
    - [ ] Less minimal web example. A nodejs module example because most people don't roll pure html.
    - [X] REST API server. There is one now but I guess it is too minimal. It works great though. It uses the game folder so that is very standard
    - [X] Final version of gchimp ResMake. To help the server distribute maps faster, gchimp ResMake zip option pre-processess all the files
    so that the server only needs to distribute the archive instead of searchign for files in the game install.
    - [X] URL Query as config. "localhost/?mapname=de_dust2&location=1,3,4" or "localhost/?replayname=abcde.dem"
  - BSP Loads:
    - [X] BSP self
    - [ ] BSP another
    - [X] MDL
    - [ ] SPR
  - User interface. `egui` probably works
    - [X] usable interface
    - [X] seek bar for demo
    - [ ] demo checker ui?
    - [X] Map list
    - [X] Demo list
- [X] Sound
- On screen text
  - [X] Chat message
  - [ ] Timer? Health? Armor? maybe not needed
  - [X] TeTextMessage?
- [ ] Instructions on how to use it